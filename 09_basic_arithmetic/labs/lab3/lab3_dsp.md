# Лабораторная работа 3. DSP-ячейки


## Воспроизведите примеры "Умножение без DSP" и "Умножение с DSP"

### 1.  Проведите синтез обоих примеров и сравните Utilization. Почему пример "без DSP" использует LUT, а пример "с DSP" не использует их? Откройте Synthesis > Schematic для обоих примеров и объясните увиденное


#### без DSP:


Slice Logic
--------------

|        Site Type        | Used | Fixed | Prohibited | Available | Util% |
|-------------------------|------|-------|------------|-----------|-------|
| Slice LUTs*             |  465 |     0 |          0 |     63400 |  0.73 |
|   LUT as Logic          |  465 |     0 |          0 |     63400 |  0.73 |
|   LUT as Memory         |    0 |     0 |          0 |     19000 |  0.00 |
| Slice Registers         |   86 |     0 |          0 |    126800 |  0.07 |
|   Register as Flip Flop |   86 |     0 |          0 |    126800 |  0.07 |
|   Register as Latch     |    0 |     0 |          0 |    126800 |  0.00 |
| F7 Muxes                |    0 |     0 |          0 |     31700 |  0.00 |
| F8 Muxes                |    0 |     0 |          0 |     15850 |  0.00 |


DSP
------

| Site Type | Used | Fixed | Prohibited | Available | Util% |
|-----------|------|-------|------------|-----------|-------|
| DSPs      |    0 |     0 |          0 |       240 |  0.00 |


![страшно](../../pic/DSP/no_dsp.png)

------------
#### Используя DSP:


 Slice Logic
--------------


|        Site Type        | Used | Fixed | Prohibited | Available | Util% |
|-------------------------|------|-------|------------|-----------|-------|
| Slice LUTs*             |    0 |     0 |          0 |     63400 |  0.00 |
|   LUT as Logic          |    0 |     0 |          0 |     63400 |  0.00 |
|   LUT as Memory         |    0 |     0 |          0 |     19000 |  0.00 |
| Slice Registers         |    0 |     0 |          0 |    126800 |  0.00 |
|   Register as Flip Flop |    0 |     0 |          0 |    126800 |  0.00 |
|   Register as Latch     |    0 |     0 |          0 |    126800 |  0.00 |
| F7 Muxes                |    0 |     0 |          0 |     31700 |  0.00 |
| F8 Muxes                |    0 |     0 |          0 |     15850 |  0.00 |


 DSP
------

|    Site Type   | Used | Fixed | Prohibited | Available | Util% |
|----------------|------|-------|------------|-----------|-------|
| DSPs           |    1 |     0 |          0 |       240 |  0.42 |
|   DSP48E1 only |    1 |       |            |           |       |


![приемлемо](../../pic/DSP/dsp_mull.png)

> обьяснение: отключая возможность синтезатору использовать встроенные блоки DSP мы обрекаем его на синтез того же самого используя статическую логику лутов. Схемы выглядит громоздко т.к. в ней просто много умножителей, соответственно схема использующая DSP просто использует один блок т.к. туда влезает умножение 25*18 и шины для ее подключения.

> ИТОГО : использовать DSP выгодно по нескольким причинам 1. быстрый синтез(особенно в больших проектах) 2. скорость 3. то, что логика умножения не занимает луты

### 2. Увеличьте разрядность одного или сразу двух входов в примере "Умножение с DSP". Откройте Synthesis > Schematic и объясните увиденное.


![после увеличения разрядности в два раза](../../pic/DSP/up_bitnes.png)

> просто стало использоваться несколько dsp блоков в моем случае 6


### 3. Почему в примере "Умножение с DSP" на схеме Synthesis > Schematic отсутствуют регистры? Куда они пропали и где находятся?

> они внутри dsp т.к.

![dsp](../../pic/DSP/dsp_sch.png)

### 4. В примере "Умножение с DSP" поменяйте тип сброса на асинхронный. Что случилось с регистрами на схеме Synthesis > Schematic? Почему?

> синтезатору пришлось вынести регистры из DCP т.к. он поддерживает только регистры с синхронным сбросом


![async rst reg](../../pic/DSP/DSP_async_reg.png)

### 5. Подключите файл clk.xdc к проектам с примерами "Умножение без DSP" и "Умножение с DSP" и выполните сравнительный анализ тактовой частоты. Внимание! Для примера "Умножение с DSP" используйте top-level модуль-обёртку mult_dsp_wrapper.sv. Какие получились тактовые частоты у разных примеров? Почему они отличаются?


#### вариант с DSP:

> Worst negative slack = + 8,157 - а это значит можно ускорится. при текущем параметре в 10 нс/так, получаем 100 Мгц, а можно сделать (10-8,157) = 1.843 и 1/1.843 = 542.59 Мгц


#### вариант без DSP:

> Worst negative slack = + 0,039- а это значит остаеться минимальный запас скорости конечно можно ускориться но только на 0.4% а значит можно считать чистоту примерно в 100 Мгц


Различие больше чем в 5 раз обусловлены использованием сложной схемой на лутах

## Воспроизведите пример "Предварительное сложение"

### 1. Откройте Synthesis > Schematic. Почему на схеме не видно сумматора, который появился в этом примере?


> он внутри dsp

### 2. С помощью какого элемента DSP ячейки реализовано сложение в данном примере?

1. пре сумматор
2. умножитель


## Воспроизведите пример "Умножение с накоплением"


### 1.  Что в этом примере делает сигнал clear_i?

> Сигнал `clear_i` сбрасывает накопленную сумму:


### 2. С помощью какого элемента DSP ячейки реализовано сложение в данном примере?

1. пре сумматор
2. умножитель

## Воспроизведите пример "SIMD в АЛУ"

### 1. Измените параметр W на 20. Откройте схему Synthesis > Schematic. Что поменялось? Почему?

до:

![simd before](../../pic/DSP/alu_simd_before.png)

после  :

![simd before](../../pic/DSP/simd_alu_after.png)

> стало использоваться несколько dsp ячеек т.к перестало вмещаться в одну **(то есть разбиение одного АЛУ на 2 или 4 "виртуальных", каждый шириной по 24 или 12 бит соответственно)**
